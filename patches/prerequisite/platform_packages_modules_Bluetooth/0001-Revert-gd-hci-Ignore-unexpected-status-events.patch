From 99a5ef8b5136ebdc1cfa5c867ce719d6361a920e Mon Sep 17 00:00:00 2001
From: Alberto Ponces <ponces26@gmail.com>
Date: Thu, 29 Sep 2022 16:51:59 +0100
Subject: [PATCH 1/5] Revert "gd: hci: Ignore unexpected status events"

This reverts commit 0e4083fa349202392a7b7bbc63eca6b6a3d75dcc.
---
 system/gd/hci/hci_layer.cc | 15 ++++++++-------
 1 file changed, 8 insertions(+), 7 deletions(-)

diff --git a/system/gd/hci/hci_layer.cc b/system/gd/hci/hci_layer.cc
index b5a9d065be..57d7e55fff 100644
--- a/system/gd/hci/hci_layer.cc
+++ b/system/gd/hci/hci_layer.cc
@@ -195,13 +195,14 @@ struct HciLayer::impl {
           EventView::Create(PacketView<kLittleEndian>(std::make_shared<std::vector<uint8_t>>(std::vector<uint8_t>()))));
       command_queue_.front().GetCallback<CommandCompleteView>()->Invoke(move(command_complete_view));
     } else {
-      if (command_queue_.front().waiting_for_status_ == is_status) {
-        command_queue_.front().GetCallback<TResponse>()->Invoke(move(response_view));
-      } else {
-        CommandCompleteView command_complete_view = CommandCompleteView::Create(
-            EventView::Create(PacketView<kLittleEndian>(std::make_shared<std::vector<uint8_t>>(std::vector<uint8_t>()))));
-        command_queue_.front().GetCallback<CommandCompleteView>()->Invoke(move(command_complete_view));
-      }
+      ASSERT_LOG(
+          command_queue_.front().waiting_for_status_ == is_status,
+          "0x%02hx (%s) was not expecting %s event",
+          op_code,
+          OpCodeText(op_code).c_str(),
+          logging_id.c_str());
+
+      command_queue_.front().GetCallback<TResponse>()->Invoke(move(response_view));
     }
 
     command_queue_.pop_front();
-- 
2.34.1

